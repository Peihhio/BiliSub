# BiliSub -  B站视频字幕硬核提取工具 🚀

[![Docker Image](https://img.shields.io/docker/v/peihhio/bilisub?logo=docker&label=docker%20pull)](https://hub.docker.com/r/peihhio/bilisub)
[![Python](https://img.shields.io/badge/Python-3.11-blue?logo=python)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

BiliSub 是一个专为笔记党、知识库构建者和 B 站重度用户打造的智能字幕提取与 AI 处理工具。它不仅仅是一个简单的下载器，更是一个集成了**智能策略路由**、**高性能语音转写**和**大模型知识加工**的全流程解决方案。

**核心理念：自己的需求自己掌握，自己的开支自己节约。** 💸

---

## ✨ 核心亮点 (Why BiliSub?)

### 1. 💰 极致的成本控制策略
市面上的同类产品大多无脑调用语音识别 API，无论视频是否自带字幕，导致成本高昂且速度慢。
BiliSub 采用**智能双模提取策略**：
- **自带字幕（CC/硬字幕）**：直接秒级提取，**0 成本，0 等待**。
- **无字幕视频**：自动切换调用阿里云 Paraformer 语音大模型进行转写。
- **成本估算**：语音转写仅需约 **0.3 元/小时**（视频时长），充值 1 元即可处理约 3 小时的高质量无字幕视频内容。
- **视频合集提取**：对于B站视频合集，提取策略为优先把所有带字幕的视频字幕免费秒提，然后通过Paraformer并发提取剩余无字幕视频的字幕。

### 2. ⚡️ 惊人的转写效率
得益于阿里云 Paraformer-v2 模型的强大性能，转写速度远超传统 Whisper。
- **实测数据**：一部 **30 分钟** 的无字幕视频，仅需 **1-2 分钟** 即可完成全文转写。

### 3. 🚀 两种运行模式（均支持高并发）
- **自建 HTTP/HTTPS 模式（推荐）**：
  - 如果你有公网 IP 或域名（支持 HTTP 和 HTTPS），系统将直接生成直链提交给阿里云
  - **支持 5 并发多任务同时提取**，稳定且高速
  
- **第三方直链模式（开箱即用）** ⭐️ **NEW**：
  - **智能并发探测**：同时检测 5 个第三方存储服务（tmpfile.link、litterbox.catbox.moe、file.io 等）的可用性
  - **并发上传**：同时上传到所有可用服务，谁先成功用谁，大幅提升上传速度和成功率
  - **5 并发处理**：支持同时处理 5 个视频，相比之前的串行模式速度提升 **5 倍**
  - **零配置**：无需公网环境，无需任何配置，开箱即用
  - **自动容错**：单个服务失败自动切换，确保上传成功率

### 4. 🧠 内置 AI 知识加工
不仅是提取，更是处理。
- **AI 摘要与重写**：填写 API Key 后，默认调用阿里大模型（通义千问）对字幕进行总结、提取金句或重写。
- **模型兼容**：支持自定义 OpenAI 格式的 API，兼容 DeepSeek、ChatGPT 等主流模型。

### 5. 📚 Obsidian / 知识库友好
专为知识管理设计：
- **Markdown 导出**：自动将字幕生成为格式整洁的 Markdown 文件。
- **YAML Frontmatter**：提取的视频元数据（标题、UP主、分区、标签等）自动写入文件头部的 YAML 区域。
- **无缝集成**：下载后可直接拖入 **Obsidian** 使用 Bases 管理，或直接作为语料投喂给 LLM 构建个人知识库。

---

## 🛠️ 部署指南 (Docker)

无需配置复杂的 Python 环境，一行 Docker 命令即可部署。

### 快速启动

```bash
docker run -d \
  --name bilisub \
  -p 5001:5001 \
  -v $(pwd)/data:/app/database \
  peihhio/bilisub:latest
```

访问浏览器：`http://localhost:5001` 即可开始使用。

### 🔑 默认账号

首次登录请使用以下账号（建议登录后立即修改密码）：

| 角色 | 用户名 | 密码 | 权限 |
| :--- | :--- | :--- | :--- |
| **管理员** | `admin` | `admin` | 拥有所有权限，可管理账户，配置邀请码 |
| **访客** | `guest` | `guest` | 每日限提取 5 条，适合公开演示，仅能串行任务 |

---

## ⚙️ 使用建议

为了获得"丝般顺滑"的体验，强烈建议在使用前准备好以下两项：

1.  **阿里云 DashScope API Key** ([点击申请](https://dashscope.console.aliyun.com/))
    *   用于语音转写和 AI 总结，这是本项目高性能的核心。建议预充值少许余额（如 1-5 元）。
2.  **B站 Cookie (SESSDATA)**
    *   **重要**：B 站对未登录用户的 API 调用有限制，且部分自带字幕需要登录才能正确获取。
    *   配置 Cookie 后，提取的准确率和成功率大幅提升。
3.  **配置自建 HTTP/HTTPS 服务 (可选但推荐)**
    *   如果你拥有公网 IP 或域名（支持 HTTP 和 HTTPS），强烈建议在设置中开启并配置。
    *   这将解锁**多任务并发提取**功能，绕过第三方直链服务的不稳定性，实现极速转录。

---

## 🌟 进阶玩法

### 🎯 提示词工程 (Prompt Engineering)
不只是简单的总结！你可以在**配置**中自定义 System Prompt，实现无限可能：
- **金句提取**：`请提取视频中出现的不少于5条金句或核心观点。`
- **学习笔记**：`请以康奈尔笔记法的格式总结这份内容，包含核心关键词、摘要和大纲。`
- **翻译官**：`请将字幕内容翻译为英文，并总结要点。`
- **一句话总结**：`请用一句话概括视频主旨，适合快速筛选视频。`

### 📦 批量生产力
- **合集提取**：支持直接粘贴 B 站合集/播放列表链接，一键将整个系列的视频全部抓取。
- **Guest 账户限制**：内置 Guest 访客模式（每日限额5条），便于分享给朋友体验而不被滥用，全部Guest用户视频串行提取字幕。

---

## ⚠️ 注意事项 (Caveats)

1.  **运行模式对比**
    - **自建服务（推荐）**：支持 HTTP 和 HTTPS，系统会开启直链模式，支持**5 并发**提取，速度极快，直接连接阿里云。
    - **第三方直链模式**：使用内置的第三方直链服务中转，现已支持**5 并发**处理和**智能并发上传**，速度大幅提升，适合个人使用。

2.  **Cookie 有效期**
    - B 站 Cookie 会定期失效（通常半个月到一个月）。
    - 遇到提取失败（特别是 412 错误）时，请第一时间检查配置中的 Cookie 状态指示灯，或重新复制最新 Cookie。

3.  **数据安全与隐私**
    - 你的 API Key 和 Cookie 均加密存储在你部署的服务器本地数据库 (`data/bilisub.db`) 中。
    - **绝不会上传到任何第三方，也不会被项目作者收集**。
    - 如果是在公共电脑上使用，建议使用浏览器无痕模式，登录guest账户，并在使用后点击页面底部的"清理缓存"。

---

##  导出示例

生成的 `.md` 文件头部包含丰富的元数据：

```markdown
---
Title: "【硬核】如何用 AI 构建个人知识库？"
BVID: BV1xxxxx
Author: "某知名UP主"
Duration: 18:20
PubDate: 2024-01-01
URL: "https://www.bilibili.com/video/BV1xxxxx"
Processed: true
AI_Summary: "本视频主要讲解了..."
---

大家好，今天我们来聊聊知识管理...
```

---
